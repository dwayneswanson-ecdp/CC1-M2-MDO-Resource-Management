



  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="google" content="notranslate">
  <meta http-equiv="Content-Language" content="en">
  <meta name="robots" content="no-translate">
  <title>CC - English -</title>

  <!-- Quill CSS -->
  <link href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" rel="stylesheet">

 <style>
  /* Anti-copy / anti-translate behaviour ‚Äì leave as is for exam security */
  html, body {
    translate: none !important;
    -webkit-user-select: none;
    user-select: none;
    -webkit-touch-callout: none;
    margin: 0;
    padding: 0;
  }
  * { translate: none !important; }

  /* Global body */
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, Helvetica, sans-serif;
    background: #f5f7fb;
    color: #222;
    font-size: 16px;
    line-height: 1.6;
    padding-top: 90px; /* space for fixed header (adjust if needed) */
  }

  /* Fixed exam header ‚Äì now visually closer to the new site navbar */
  header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;

    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;

    background: #ffffffcc;              /* light, slightly transparent */
    backdrop-filter: blur(10px);
    color: #111827;
    padding: 14px 24px;
    border-bottom: 1px solid #e1e4f0;
    box-shadow: 0 8px 20px rgba(15, 23, 42, 0.04);
  }

  header h1 {
    margin: 0;
    font-size: 1.2rem;
    letter-spacing: 0.03em;
    font-weight: 700;
    color: #2643e9; /* same blue accent as the new page */
  }

  /* Timer on the right */
  #timer {
    font-weight: 600;
    font-size: 0.9rem;
    text-align: right;
    color: #111827;
    padding: 4px 10px;
    border-radius: 999px;
    border: 1px solid #d1d5db;
    background: #f9fafb;
    white-space: nowrap;
  }

  /* Main exam wrapper */
  main {
    max-width: 900px;
    margin: 24px auto 40px;
    background: #ffffff;
    padding: 32px 32px 40px;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(15, 23, 42, 0.06);
  }

  /* Reusable inner cards (e.g. intro screen, confirmation, parts) */
  .card {
    background: #ffffff;
    border-radius: 16px;
    box-shadow: 0 4px 15px rgba(15, 23, 42, 0.06);
    padding: 28px 28px 32px;
    max-width: 640px;
    margin: 32px auto;
    text-align: left;
    border: 1px solid #e5e7eb;
  }

  .card h2 {
    color: #111827;
    margin-top: 0;
    margin-bottom: 10px;
    text-align: center;
    font-size: 1.1rem;
    font-weight: 600;
  }

  label {
    display: block;
    margin: 12px 0 8px;
    font-weight: bold;
    font-size: 0.95rem;
    color: #111827;
  }

  input[type="text"],
  input[type="email"],
  select,
  textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    font-size: 0.95rem;
    font-family: inherit;
    box-sizing: border-box;
    background: #ffffff;
  }

  textarea {
    resize: vertical;
    min-height: 80px;
  }

  select {
    white-space: normal;
    word-wrap: break-word;
    padding: 8px;
    background: #ffffff;
  }

  button {
    background: #2643e9;
    color: #fff;
    border: none;
    padding: 10px 24px;
    border-radius: 999px;
    cursor: pointer;
    font-size: 0.95rem;
    font-weight: 600;
    font-family: inherit;
  }
  button:hover {
    filter: brightness(0.96);
  }

  .btn-row {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin-top: 16px;
  }
  .btn-row.center { justify-content: center; }
  .btn-row.right { justify-content: flex-end; }

  .btn-light {
    background: #eef2ff;
    color: #2643e9;
    border: 1px solid #c7d2fe;
  }
  .btn-light:hover {
    background: #e0e7ff;
  }

  ol {
    padding-left: 20px;
  }
  ol li {
    margin-bottom: 14px;
    font-size: 0.95rem;
  }

  /* STEP / PART VISIBILITY ‚Äì functional: do NOT change selectors */
  #exam,
  #confirm,
  #partA,
  #partB {
    display: none;
  }
  #partA.active,
  #partB.active {
    display: block;
  }

  /* Quill editor container ‚Äì visually aligned with card style */
  .editor-card {
    border: 1px solid #e3e6ee;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 6px rgba(15, 23, 42, 0.06);
    margin-top: 12px;
  }

  .ql-toolbar.ql-snow {
    border: none;
    border-bottom: 1px solid #e3e6ee;
    background: #f9fbff;
  }

  .ql-container.ql-snow {
    border: none;
    min-height: 260px;
    background: #ffffff;
  }

  .ql-editor {
    min-height: 240px;
    font-size: 0.95rem;
  }

  .muted {
    color: #6b7280;
    font-size: 0.9rem;
  }

  /* Name row layout */
  .name-row {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }
  .name-row .field {
    flex: 1 1 0;
  }

  /* Visually force uppercase display on last name */
  .upper {
    text-transform: uppercase;
  }
/* === Part A ‚Äì Vocabulary Matching layout === */

#partA h2 {
  text-align: left;
  margin-bottom: 0.5rem;
}

.partA-intro {
  font-size: 0.9rem;
  color: #6b7280;
  margin-bottom: 1.25rem;
}

/* Each line = grid: term on the left, dropdown on the right */
#partA ol {
  margin: 0;
  padding-left: 1.5rem; /* keeps automatic numbering */
}

#partA ol li {
  margin-bottom: 12px;
}

.vocab-row {
  display: grid;
  grid-template-columns: minmax(0, 0.7fr) minmax(0, 1.3fr);
  column-gap: 18px;
  align-items: center;
}

.vocab-term {
  font-size: 0.95rem;
  color: #111827;
  font-weight: 500;
}

.vocab-select {
  margin: 0;
}

/* On mobile, stack term + select */
@media (max-width: 720px) {
  .vocab-row {
    grid-template-columns: 1fr;
    row-gap: 6px;
  }
}
  /* Responsive tweaks */
  @media (max-width: 720px) {
    body {
      padding-top: 100px;
    }

    header {
      flex-direction: column;
      align-items: flex-start;
      gap: 6px;
      padding-inline: 16px;
    }

    #timer {
      align-self: flex-end;
    }

    main {
      margin: 16px auto 32px;
      padding: 24px 16px 32px;
      border-radius: 12px;
    }

    .card {
      margin: 24px auto;
      padding: 20px 18px 24px;
      max-width: 100%;
    }
  }
</style>



  <header>
    <h1 id="examTitleHeader">CC1 - English ‚Äî Resource Management</h1>
    <div id="timer"></div>
  </header>

  <main>
        <!-- LOGIN -->
    <section id="login" class="card">
      <h2>Commencer l'√©preuve</h2>
      <p>Merci de renseigner vos informations pour commencer. Une fois l‚Äô√©preuve lanc√©e, vous disposerez de <b>60 minutes</b> pour la compl√©ter.</p>

      <label>Nom et pr√©nom :</label>
      <div class="name-row">
        <div class="field">
          <input type="text" id="studentLastName" class="upper" placeholder="NOM (en majuscules)" required>
        </div>
        <div class="field">
          <input type="text" id="studentFirstName" placeholder="Pr√©nom" required>
        </div>
      </div>

      <label>Adresse e-mail :</label>
      <input type="email" id="studentEmail" required>

            <label>Groupe :</label>
      <select id="groupSelect" required>
        <option value="">S√©lectionner votre groupe</option>
        <option value="M2 MDO G1">M2 MDO G1</option>
        <option value="M2 MDO G2">M2 MDO G2</option>
        <option value="M2 MDO G3">M2 MDO G3</option>
      </select>
      
      <label>Code de classe :</label>
      <input type="text" id="classCode" required>

      

      <div class="btn-row center">
        <button id="startBtn" type="button">Commencer</button>
      </div>
    </section>

    <!-- CONFIRM -->
    <section id="confirm" class="card">
      <h2>Veuillez confirmer vos informations</h2>
      <p><b>Nom &amp; pr√©nom :</b> <span id="confirmName"></span></p>
      <p><b>Email :</b> <span id="confirmEmail"></span></p>
      <p><b>Groupe :</b> <span id="confirmGroup"></span></p>
      <p class="muted">
        Veuillez v√©rifier que ces informations sont correctes. Si quelque chose ne l‚Äôest pas, cliquez sur ¬´ Modifier ¬ª pour revenir √† l‚Äô√©cran pr√©c√©dent.
      </p>
      <div class="btn-row">
        <button type="button" class="btn-light" id="confirmBackBtn">‚Üê Modifier</button>
        <button type="button" id="confirmBeginBtn">Commencer l'√©preuve ‚Üí</button>
      </div>
    </section>

    <!-- EXAM -->
    <section id="exam">
      <form id="examForm">
              <input type="hidden" name="studentName" id="studentNameField">
        <input type="hidden" name="studentEmail" id="studentEmailField">
        <input type="hidden" name="classCode" id="classCodeField">
        <input type="hidden" name="groupName" id="groupNameField">

        <!-- PART A -->
        <div id="partA" class="active">
          <h2>Part A ‚Äì Vocabulary Matching</h2>
          <p class="partA-intro">
            Match each term with the correct definition by selecting an option in the dropdown list.
          </p>

          <ol>
            <li>
              <div class="vocab-row">
                <span class="vocab-term">Budget</span>
                <select name="q1" class="vocab-select">
                  <option value="">Select a definition</option>
                  <option>A detailed financial plan that estimates how much money an organisation expects to earn and spend over a specific period.</option>
                  <option>A prediction of future results (such as sales, costs, or profits) based on current data, trends, and assumptions.</option>
                  <option>A measurable value that shows how effectively a company or team is achieving an important business objective.</option>
                  <option>A company or person that provides goods or services to another company, usually as part of a commercial contract.</option>
                  <option>The total number of employees working in an organisation, department, or team.</option>
                  <option>The time between placing an order and receiving the product or service, including production and delivery.</option>
                  <option>The stock of goods, materials, or products that a company holds for use in production or for sale to customers.</option>
                  <option>The ongoing business expenses that are not directly linked to producing a specific product or service, such as rent, utilities, or administration.</option>
                  <option>Doing business in a way that meets current needs without harming the environment, society, or future generations.</option>
                  <option>A measure that compares the profit gained from an investment to the amount of money invested, usually expressed as a percentage.</option>
                </select>
              </div>
            </li>

            <li>
              <div class="vocab-row">
                <span class="vocab-term">Forecast</span>
                <select name="q2" class="vocab-select">
                  <option value="">Select a definition</option>
                  <option>A detailed financial plan that estimates how much money an organisation expects to earn and spend over a specific period.</option>
                  <option>A prediction of future results (such as sales, costs, or profits) based on current data, trends, and assumptions.</option>
                  <option>A measurable value that shows how effectively a company or team is achieving an important business objective.</option>
                  <option>A company or person that provides goods or services to another company, usually as part of a commercial contract.</option>
                  <option>The total number of employees working in an organisation, department, or team.</option>
                  <option>The time between placing an order and receiving the product or service, including production and delivery.</option>
                  <option>The stock of goods, materials, or products that a company holds for use in production or for sale to customers.</option>
                  <option>The ongoing business expenses that are not directly linked to producing a specific product or service, such as rent, utilities, or administration.</option>
                  <option>Doing business in a way that meets current needs without harming the environment, society, or future generations.</option>
                  <option>A measure that compares the profit gained from an investment to the amount of money invested, usually expressed as a percentage.</option>
                </select>
              </div>
            </li>

            <li>
              <div class="vocab-row">
                <span class="vocab-term">KPI (Key Performance Indicator)</span>
                <select name="q3" class="vocab-select">
                  <option value="">Select a definition</option>
                  <option>A detailed financial plan that estimates how much money an organisation expects to earn and spend over a specific period.</option>
                  <option>A prediction of future results (such as sales, costs, or profits) based on current data, trends, and assumptions.</option>
                  <option>A measurable value that shows how effectively a company or team is achieving an important business objective.</option>
                  <option>A company or person that provides goods or services to another company, usually as part of a commercial contract.</option>
                  <option>The total number of employees working in an organisation, department, or team.</option>
                  <option>The time between placing an order and receiving the product or service, including production and delivery.</option>
                  <option>The stock of goods, materials, or products that a company holds for use in production or for sale to customers.</option>
                  <option>The ongoing business expenses that are not directly linked to producing a specific product or service, such as rent, utilities, or administration.</option>
                  <option>Doing business in a way that meets current needs without harming the environment, society, or future generations.</option>
                  <option>A measure that compares the profit gained from an investment to the amount of money invested, usually expressed as a percentage.</option>
                </select>
              </div>
            </li>

            <li>
              <div class="vocab-row">
                <span class="vocab-term">Supplier</span>
                <select name="q4" class="vocab-select">
                  <option value="">Select a definition</option>
                  <option>A detailed financial plan that estimates how much money an organisation expects to earn and spend over a specific period.</option>
                  <option>A prediction of future results (such as sales, costs, or profits) based on current data, trends, and assumptions.</option>
                  <option>A measurable value that shows how effectively a company or team is achieving an important business objective.</option>
                  <option>A company or person that provides goods or services to another company, usually as part of a commercial contract.</option>
                  <option>The total number of employees working in an organisation, department, or team.</option>
                  <option>The time between placing an order and receiving the product or service, including production and delivery.</option>
                  <option>The stock of goods, materials, or products that a company holds for use in production or for sale to customers.</option>
                  <option>The ongoing business expenses that are not directly linked to producing a specific product or service, such as rent, utilities, or administration.</option>
                  <option>Doing business in a way that meets current needs without harming the environment, society, or future generations.</option>
                  <option>A measure that compares the profit gained from an investment to the amount of money invested, usually expressed as a percentage.</option>
                </select>
              </div>
            </li>

            <li>
              <div class="vocab-row">
                <span class="vocab-term">Headcount</span>
                <select name="q5" class="vocab-select">
                  <option value="">Select a definition</option>
                  <option>A detailed financial plan that estimates how much money an organisation expects to earn and spend over a specific period.</option>
                  <option>A prediction of future results (such as sales, costs, or profits) based on current data, trends, and assumptions.</option>
                  <option>A measurable value that shows how effectively a company or team is achieving an important business objective.</option>
                  <option>A company or person that provides goods or services to another company, usually as part of a commercial contract.</option>
                  <option>The total number of employees working in an organisation, department, or team.</option>
                  <option>The time between placing an order and receiving the product or service, including production and delivery.</option>
                  <option>The stock of goods, materials, or products that a company holds for use in production or for sale to customers.</option>
                  <option>The ongoing business expenses that are not directly linked to producing a specific product or service, such as rent, utilities, or administration.</option>
                  <option>Doing business in a way that meets current needs without harming the environment, society, or future generations.</option>
                  <option>A measure that compares the profit gained from an investment to the amount of money invested, usually expressed as a percentage.</option>
                </select>
              </div>
            </li>

            <li>
              <div class="vocab-row">
                <span class="vocab-term">Lead time</span>
                <select name="q6" class="vocab-select">
                  <option value="">Select a definition</option>
                  <option>A detailed financial plan that estimates how much money an organisation expects to earn and spend over a specific period.</option>
                  <option>A prediction of future results (such as sales, costs, or profits) based on current data, trends, and assumptions.</option>
                  <option>A measurable value that shows how effectively a company or team is achieving an important business objective.</option>
                  <option>A company or person that provides goods or services to another company, usually as part of a commercial contract.</option>
                  <option>The total number of employees working in an organisation, department, or team.</option>
                  <option>The time between placing an order and receiving the product or service, including production and delivery.</option>
                  <option>The stock of goods, materials, or products that a company holds for use in production or for sale to customers.</option>
                  <option>The ongoing business expenses that are not directly linked to producing a specific product or service, such as rent, utilities, or administration.</option>
                  <option>Doing business in a way that meets current needs without harming the environment, society, or future generations.</option>
                  <option>A measure that compares the profit gained from an investment to the amount of money invested, usually expressed as a percentage.</option>
                </select>
              </div>
            </li>

            <li>
              <div class="vocab-row">
                <span class="vocab-term">Inventory</span>
                <select name="q7" class="vocab-select">
                  <option value="">Select a definition</option>
                  <option>A detailed financial plan that estimates how much money an organisation expects to earn and spend over a specific period.</option>
                  <option>A prediction of future results (such as sales, costs, or profits) based on current data, trends, and assumptions.</option>
                  <option>A measurable value that shows how effectively a company or team is achieving an important business objective.</option>
                  <option>A company or person that provides goods or services to another company, usually as part of a commercial contract.</option>
                  <option>The total number of employees working in an organisation, department, or team.</option>
                  <option>The time between placing an order and receiving the product or service, including production and delivery.</option>
                  <option>The stock of goods, materials, or products that a company holds for use in production or for sale to customers.</option>
                  <option>The ongoing business expenses that are not directly linked to producing a specific product or service, such as rent, utilities, or administration.</option>
                  <option>Doing business in a way that meets current needs without harming the environment, society, or future generations.</option>
                  <option>A measure that compares the profit gained from an investment to the amount of money invested, usually expressed as a percentage.</option>
                </select>
              </div>
            </li>

            <li>
              <div class="vocab-row">
                <span class="vocab-term">Overhead</span>
                <select name="q8" class="vocab-select">
                  <option value="">Select a definition</option>
                  <option>A detailed financial plan that estimates how much money an organisation expects to earn and spend over a specific period.</option>
                  <option>A prediction of future results (such as sales, costs, or profits) based on current data, trends, and assumptions.</option>
                  <option>A measurable value that shows how effectively a company or team is achieving an important business objective.</option>
                  <option>A company or person that provides goods or services to another company, usually as part of a commercial contract.</option>
                  <option>The total number of employees working in an organisation, department, or team.</option>
                  <option>The time between placing an order and receiving the product or service, including production and delivery.</option>
                  <option>The stock of goods, materials, or products that a company holds for use in production or for sale to customers.</option>
                  <option>The ongoing business expenses that are not directly linked to producing a specific product or service, such as rent, utilities, or administration.</option>
                  <option>Doing business in a way that meets current needs without harming the environment, society, or future generations.</option>
                  <option>A measure that compares the profit gained from an investment to the amount of money invested, usually expressed as a percentage.</option>
                </select>
              </div>
            </li>

            <li>
              <div class="vocab-row">
                <span class="vocab-term">Sustainability</span>
                <select name="q9" class="vocab-select">
                  <option value="">Select a definition</option>
                  <option>A detailed financial plan that estimates how much money an organisation expects to earn and spend over a specific period.</option>
                  <option>A prediction of future results (such as sales, costs, or profits) based on current data, trends, and assumptions.</option>
                  <option>A measurable value that shows how effectively a company or team is achieving an important business objective.</option>
                  <option>A company or person that provides goods or services to another company, usually as part of a commercial contract.</option>
                  <option>The total number of employees working in an organisation, department, or team.</option>
                  <option>The time between placing an order and receiving the product or service, including production and delivery.</option>
                  <option>The stock of goods, materials, or products that a company holds for use in production or for sale to customers.</option>
                  <option>The ongoing business expenses that are not directly linked to producing a specific product or service, such as rent, utilities, or administration.</option>
                  <option>Doing business in a way that meets current needs without harming the environment, society, or future generations.</option>
                  <option>A measure that compares the profit gained from an investment to the amount of money invested, usually expressed as a percentage.</option>
                </select>
              </div>
            </li>

            <li>
              <div class="vocab-row">
                <span class="vocab-term">ROI (Return on Investment)</span>
                <select name="q10" class="vocab-select">
                  <option value="">Select a definition</option>
                  <option>A detailed financial plan that estimates how much money an organisation expects to earn and spend over a specific period.</option>
                  <option>A prediction of future results (such as sales, costs, or profits) based on current data, trends, and assumptions.</option>
                  <option>A measurable value that shows how effectively a company or team is achieving an important business objective.</option>
                  <option>A company or person that provides goods or services to another company, usually as part of a commercial contract.</option>
                  <option>The total number of employees working in an organisation, department, or team.</option>
                  <option>The time between placing an order and receiving the product or service, including production and delivery.</option>
                  <option>The stock of goods, materials, or products that a company holds for use in production or for sale to customers.</option>
                  <option>The ongoing business expenses that are not directly linked to producing a specific product or service, such as rent, utilities, or administration.</option>
                  <option>Doing business in a way that meets current needs without harming the environment, society, or future generations.</option>
                  <option>A measure that compares the profit gained from an investment to the amount of money invested, usually expressed as a percentage.</option>
                </select>
              </div>
            </li>
          </ol>

          <div class="btn-row right">
            <button type="button" id="toPartB">Suivant ‚Üí Part B</button>
          </div>
        </div>

                <!-- PART B -->
        <div id="partB">
          <h2>Part B ‚Äì Writing: Email to Your Manager</h2>

          <p class="muted"><strong>Context</strong></p>
          <p class="muted">
            You work for an emerging sports brand. In a meeting, we discussed the business strategy of the
            sportswear brand <em>On</em>, and how it uses its resources to support growth and stay competitive
            (planning, costs, suppliers, customers, etc.). Your manager did not attend the presentation but
            wants to understand what you learned and how it could help the company.
          </p>

          <p class="muted"><strong>Task</strong></p>
          <ul class="muted">
            <li>Explain how On is managing its resources (in your own words).</li>
            <li>Analyse why this approach is important for long-term performance.</li>
            <li>Suggest 1‚Äì2 concrete actions a sportswear company could take to improve its strategy.</li>
          </ul>

          <p class="muted"><strong>Requirements</strong></p>
          <ul class="muted">
            <li>Use at least THREE (3) words from the vocabulary discussed in class.</li>
            <li>
              Include a clear email structure:
              subject line,  short introduction, development,  conclusion, and 
              appropriate sign-off.
            </li>
            <li>Use formal, professional language.</li>
            <li>Write a coherent, well-organised email.</li>
          </ul>

          <div class="editor-card">
            <div id="editor"></div>
          </div>

          <div class="btn-row">
            <button type="button" class="btn-light" id="toPartA">‚Üê Retour √† la partie A</button>
            <button type="submit">Envoyer l'√©preuve</button>
          </div>
        </div>
      </form>
    </section>
  </main>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>

<script>
  // ----- Global configuration for this exam -----
const EXAM_CONFIG = {
  // Unique ID for this exam (used for localStorage keys etc.)
  examId: "M2MD_CC1_2025",

  // Class code students must enter (shared for all groups)
  classCode: "BLANK",

  // Optional: special code that puts the exam in debug mode (future use)
  debugCode: "DEBUG",

  // Base title without group ‚Äì we will append "(M2 MDO G1 / G2 / G3)" dynamically
  examTitleBase: "CC1 - English ‚Äî Resource Management",

  // If you want, just for reference
  allowedGroups: ["M2 MDO G1", "M2 MDO G2", "M2 MDO G3"],

  // Time limit in minutes
  timeLimitMinutes: 60,

  // Subject line template for the email you receive
  // "(NAME)" ‚Üí student's name, "(GROUP)" ‚Üí selected group
  emailSubjectTemplate: "(NAME) CC1 - English - (GROUP)",

  // Label used in the report (we‚Äôll override with the selected group)
  classLabel: "M2MDOG" // fallback, not really used once groups are in place
};
// ----- Global exam timer + Quill state -----
const DEADLINE_KEY = "examDeadline_" + EXAM_CONFIG.examId;
let examDeadline = null;
let timer = null;
let quill = null;
  // Browser / device flags ‚Äì set inside DOMContentLoaded
let isIOS = false;
let isMobile = false;
let isSafari = false;
 
  let safeBlurUntil = 0;

function armSafeBlur(ms = 1200) {
  safeBlurUntil = Date.now() + ms;
}

let selectedGroup = "";              // üëà new
let currentExamTitle = EXAM_CONFIG.examTitleBase; // üëà new

  // Restore deadline ONLY if still valid
  (function restoreDeadline() {
    const stored = localStorage.getItem(DEADLINE_KEY);
    if (!stored) return;
    const parsed = parseInt(stored, 10);
    if (!Number.isNaN(parsed) && parsed > Date.now()) {
      examDeadline = parsed;
      console.log("‚è± Restored valid examDeadline:", new Date(examDeadline).toISOString());
    } else {
      console.log("‚è± Stored examDeadline expired/invalid ‚Üí clearing.");
      localStorage.removeItem(DEADLINE_KEY);
    }
  })();

  // Correct answers + word list (Part A)
  const correctAnswers = {
    q1: "A detailed financial plan that estimates how much money an organisation expects to earn and spend over a specific period.",
    q2: "A prediction of future results (such as sales, costs, or profits) based on current data, trends, and assumptions.",
    q3: "A measurable value that shows how effectively a company or team is achieving an important business objective.",
    q4: "A company or person that provides goods or services to another company, usually as part of a commercial contract.",
    q5: "The total number of employees working in an organisation, department, or team.",
    q6: "The time between placing an order and receiving the product or service, including production and delivery.",
    q7: "The stock of goods, materials, or products that a company holds for use in production or for sale to customers.",
    q8: "The ongoing business expenses that are not directly linked to producing a specific product or service, such as rent, utilities, or administration.",
    q9: "Doing business in a way that meets current needs without harming the environment, society, or future generations.",
    q10: "A measure that compares the profit gained from an investment to the amount of money invested, usually expressed as a percentage."
  };

  const wordNames = [
    "Budget",
    "Forecast",
    "KPI (Key Performance Indicator)",
    "Supplier",
    "Headcount",
    "Lead time",
    "Inventory",
    "Overhead",
    "Sustainability",
    "ROI (Return on Investment)"
  ];

  // Create Quill lazily (only when Part B is shown)
  function ensureQuill() {
    if (quill) return;

    quill = new Quill("#editor", {
      theme: "snow",
      modules: {
        toolbar: [
          ["bold", "italic", "underline"],
          [{ list: "ordered" }, { list: "bullet" }],
          ["clean"]
        ]
      }
    });

    // Lock down copy/paste etc.
    const root = quill.root;
        // ---------------------------------------------------------
    // 4b ‚Äî SAFE BLUR ARMING FOR QUILL EDITOR (iPhone keyboard)
    // ---------------------------------------------------------
    ["focus", "click", "keydown"].forEach(evt => {
      root.addEventListener(evt, () => {
        if (isMobile) armSafeBlur(1500);
      });
    });

    root.addEventListener("contextmenu", e => e.preventDefault());
    root.addEventListener("paste", e => e.preventDefault());
    root.addEventListener("copy", e => e.preventDefault());
    root.addEventListener("cut", e => e.preventDefault());
    root.addEventListener("drop", e => e.preventDefault());
    root.addEventListener("keydown", e => {
      if ((e.ctrlKey || e.metaKey) && ["c", "v", "x", "a"].includes(e.key.toLowerCase())) {
        e.preventDefault();
      }
    });
  }

  // Randomise options but keep first option as "-- Choose --"
  function randomizeSelectsKeepFirst() {
    document.querySelectorAll("#partA select").forEach(sel => {
      const opts = Array.from(sel.options);
      const first = opts.shift(); // "-- Choose --"
      for (let i = opts.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [opts[i].text, opts[j].text] = [opts[j].text, opts[i].text];
      }
      sel.innerHTML = "";
      sel.appendChild(first);
      opts.forEach(o => sel.appendChild(o));
      sel.selectedIndex = 0;
    });
  }

  // Randomise question order in Part A
  function randomizeQuestionOrder() {
    const list = document.querySelector("#partA ol");
    if (!list) return;
    const items = Array.from(list.children);

    for (let i = items.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [items[i], items[j]] = [items[j], items[i]];
    }

    items.forEach(li => list.appendChild(li));
  }

document.addEventListener("DOMContentLoaded", function() {
  // ---- User agent / device flags ----
  const ua = navigator.userAgent;

  const isIOS =
    /iPad|iPhone|iPod/.test(ua) ||
    (navigator.platform === "MacIntel" && navigator.maxTouchPoints > 1);

  const isMobile = /Mobi|Android/i.test(ua) || isIOS;
  // Make it available to functions defined outside this block (like ensureQuill)
  window.isMobile = isMobile;

  // üîπ Detect Safari (desktop & iOS) ‚Äì block the exam on this browser
  const isSafari = /^((?!chrome|crios|fxios|android).)*safari/i.test(ua);

  if (isSafari) {
    const main = document.querySelector("main");
    if (main) {
      main.innerHTML = `
        <section class="card">
          <h2 style="display:flex; align-items:center; gap:8px; margin-top:0;">
            <span>‚ö†Ô∏è</span>
            <span>Navigateur non pris en charge</span>
          </h2>
          <p>
            Pour des raisons techniques, cette √©preuve en ligne n‚Äôest pas disponible sur
            <strong>Safari</strong>.
          </p>
          <p>
            Merci d‚Äôouvrir ce lien dans l‚Äôun des navigateurs suivants&nbsp;:
          </p>
          <ul>
            <li><strong>Google Chrome</strong></li>
            <li><strong>Microsoft Edge</strong></li>
            <li><strong>Mozilla Firefox</strong></li>
          </ul>
          <p class="muted">
            Si vous voyez encore ce message alors que vous utilisez d√©j√† l‚Äôun de ces navigateurs,
            merci d‚Äôen informer imm√©diatement votre enseignant.
          </p>
        </section>
      `;
    }

    const timer = document.getElementById("timer");
    if (timer) {
      timer.textContent = "";
    }

    // Stop all further exam initialisation on Safari
    return;
  }

  // üîª Rest of the exam logic for supported browsers

  if (window.emailjs) {
    try {
      emailjs.init({
        publicKey: "Bb0oPYBiZGQcyIz5r",
      });
    } catch (e) {
      console.error("EmailJS init error:", e);
    }
  }

  // ----- DOM Elements -----
  const login = document.getElementById("login");
  const confirmSec = document.getElementById("confirm");
  const exam = document.getElementById("exam");
  const titleHeader = document.getElementById("examTitleHeader");

  if (titleHeader) {
    titleHeader.textContent = EXAM_CONFIG.examTitleBase; // base without group
  }

  const startBtn = document.getElementById("startBtn");
  const confirmBackBtn = document.getElementById("confirmBackBtn");
  const confirmBeginBtn = document.getElementById("confirmBeginBtn");

  const confirmName = document.getElementById("confirmName");
  const confirmEmail = document.getElementById("confirmEmail");
  const confirmGroup = document.getElementById("confirmGroup");

  const partA = document.getElementById("partA");
  const partB = document.getElementById("partB");
  const toPartA = document.getElementById("toPartA");
  const toPartB = document.getElementById("toPartB");

  const timerDisplay = document.getElementById("timer");
  const form = document.getElementById("examForm");

  const studentFirstNameInput = document.getElementById("studentFirstName");
  const studentLastNameInput = document.getElementById("studentLastName");
  const studentEmailInput = document.getElementById("studentEmail");
  const classCodeInput = document.getElementById("classCode");
  const groupSelect = document.getElementById("groupSelect");

  // 4a ‚Äî SAFE BLUR ARMING FOR PART A DROPDOWNS (iPad issue)
  document.querySelectorAll("#partA select").forEach(sel => {
    sel.addEventListener("mousedown", () => {
      if (isMobile) armSafeBlur(1500);
    });
    sel.addEventListener("touchstart", () => {
      if (isMobile) armSafeBlur(2000);
    });
  });

  const submitBtn = form ? form.querySelector('button[type="submit"]') : null;

  const studentNameField = document.getElementById("studentNameField");
  const studentEmailField = document.getElementById("studentEmailField");
  const classCodeField = document.getElementById("classCodeField");
  const groupNameField = document.getElementById("groupNameField");

  // Guard: if any required node is missing, stop (prevents runtime chaos)
  const required = [
    login, confirmSec, exam, startBtn, confirmBackBtn, confirmBeginBtn,
    confirmName, confirmEmail, confirmGroup, partA, partB, toPartA, toPartB,
    timerDisplay, form, studentFirstNameInput, studentLastNameInput,
    studentEmailInput, classCodeInput, groupSelect
  ];
  if (required.some(n => !n)) {
    console.error("Missing required DOM nodes. Check IDs.", { required });
    return;
  }

// ----- State Flags -----
let examSubmitted = false;
let examActive = false;
let isStartingExam = false;
let exitPromptOpen = false; // NEW: avoid multiple popups

function askToExitExam(reason) {
  if (!examActive || exitPromptOpen) return;

  exitPromptOpen = true;

  const proceed = confirm(
    reason ||
    "Vous √™tes sur le point de quitter le mode plein √©cran.\n\n" +
    "Si vous continuez, votre √©preuve sera effac√©e.\n\n" +
    "Voulez-vous vraiment quitter ?"
  );

  exitPromptOpen = false;

  if (proceed) {
    // Same message you already use in terminateExam
    terminateExam(
      "Vous avez quitt√© l'√©cran de l'√©preuve. L'√©preuve est termin√©e et doit √™tre recommenc√©e."
    );
  } else {
    // Try to go back to fullscreen so they can continue
    if (!document.fullscreenElement && document.documentElement.requestFullscreen) {
      document.documentElement.requestFullscreen().catch(() => {});
    }
  }
}

  // ----- Helpers -----
  function resetToLanding() {
    console.log("üîÑ resetToLanding called");

    try {
      clearInterval(timer);
    } catch (e) {
      console.error("Error clearing timer in resetToLanding:", e);
    }

    examActive = false;
    examSubmitted = false;
    isStartingExam = false;

    if (form) form.reset();
    if (quill) quill.setText("");

    if (studentFirstNameInput) studentFirstNameInput.value = "";
    if (studentLastNameInput) studentLastNameInput.value = "";
    if (studentEmailInput) studentEmailInput.value = "";
    if (classCodeInput) classCodeInput.value = "";
    if (groupSelect) groupSelect.value = "";
    selectedGroup = "";
    currentExamTitle = EXAM_CONFIG.examTitleBase;

    if (titleHeader) {
      titleHeader.textContent = currentExamTitle;
    }

    // UI: show only login
    login.style.display = "block";
    confirmSec.style.display = "none";
    exam.style.display = "none";

    if (submitBtn) {
      submitBtn.disabled = false;
      submitBtn.textContent = "Envoyer l'√©preuve";
    }

    console.log("‚úÖ Landing screen forced.");
  }

  function startTimer() {
    clearInterval(timer);
    timer = setInterval(() => {
      if (!examDeadline) return;
      const now = Date.now();
      const remainingMs = examDeadline - now;
      const totalSec = Math.max(0, Math.floor(remainingMs / 1000));
      const m = Math.floor(totalSec / 60);
      const s = totalSec % 60;
      timerDisplay.textContent = `Time Remaining: ${m}:${s.toString().padStart(2, "0")}`;
      if (remainingMs <= 0) {
        clearInterval(timer);
        submitExam(); // time is up
      }
    }, 1000);
  }

  function enableFullScreen() {
    if (document.documentElement.requestFullscreen) {
      document.documentElement.requestFullscreen().catch(err => {
        console.warn("Fullscreen request failed:", err);
      });
    }
  }

  function terminateExam(message) {
    console.log("üí£ terminateExam called", {
      message,
      examActiveBefore: examActive
    });

    if (!examActive) {
      console.log("terminateExam called but examActive is already false ‚Äì ignoring.");
      return;
    }

    alert(
      message ||
      "Vous avez quitt√© l'√©cran de l'√©preuve. L'√©preuve est termin√©e et doit √™tre recommenc√©e."
    );

    resetToLanding();
  }

  // Force LAST NAME input uppercase
  studentLastNameInput.addEventListener("input", () => {
    studentLastNameInput.value = studentLastNameInput.value.toUpperCase();
  });

  // ----- Anti-cheat listeners -----
  document.addEventListener("visibilitychange", () => {
    if (isStartingExam) {
      console.log("‚è± Ignoring visibilitychange during exam startup");
      return;
    }
    if (examActive && document.hidden) {
      terminateExam(
        "Vous avez quitt√© l'√©cran de l'√©preuve. L'√©preuve est termin√©e et doit √™tre recommenc√©e."
      );
    }
  });

window.addEventListener("blur", () => {
  if (isStartingExam) {
    console.log("‚è± Ignoring blur during exam startup");
    return;
  }

  if (!examActive) return;

  // üì± On mobile (iPhone/iPad/Android), ignore blur that happens
  // right after we interacted with a select or the editor.
  if (isMobile && Date.now() < safeBlurUntil) {
    console.log("üì± Blur ignored (inside safe window)", {
      now: Date.now(),
      safeBlurUntil
    });
    return;
  }

   // Desktop or blur outside safe window ‚Üí ask for confirmation
  askToExitExam(
    "Vous √™tes sur le point de quitter la fen√™tre de l'√©preuve.\n\n" +
    "Si vous continuez, votre √©preuve sera effac√©e.\n\n" +
    "Voulez-vous vraiment quitter ?"
  );
});
  document.addEventListener("fullscreenchange", () => {
    console.log("üì∫ fullscreenchange fired", {
      examActive,
      fullscreenElement: !!document.fullscreenElement,
      isStartingExam
    });

    if (!examActive || isStartingExam) return;

     if (!document.fullscreenElement) {
    console.log("‚õî Leaving fullscreen while examActive ‚Üí askToExitExam()");
    askToExitExam(
      "Vous √™tes sur le point de quitter le mode plein √©cran.\n\n" +
      "Si vous continuez, votre √©preuve sera effac√©e.\n\n" +
      "Voulez-vous vraiment quitter ?"
    );
  }
});

document.addEventListener("keydown", e => {
  if ((e.key === "Escape" || e.key === "Esc") && examActive && !isStartingExam) {
    e.preventDefault();
    askToExitExam(
      "Vous avez appuy√© sur √âchap, ce qui quitte le mode plein √©cran.\n\n" +
      "Si vous continuez, votre √©preuve sera effac√©e.\n\n" +
      "Voulez-vous vraiment quitter ?"
    );
  }
});

  // Start from a clean landing state
  resetToLanding();

  // ----- Exam flow -----
  function beginExam() {
    const firstName = (studentFirstNameInput.value || "").trim();
    const lastName = (studentLastNameInput.value || "").trim().toUpperCase();
    const email = (studentEmailInput.value || "").trim();
    const code = (classCodeInput.value || "").trim();
    const group = selectedGroup || (groupSelect.value || "").trim();

    const fullName = `${lastName} ${firstName}`;

    studentNameField.value = fullName;
    studentEmailField.value = email;
    classCodeField.value = code;
    groupNameField.value = group;

    confirmSec.style.display = "none";
    exam.style.display = "block";
    partA.classList.add("active");
    partB.classList.remove("active");

    // Update dynamic exam title with group
    currentExamTitle = `${EXAM_CONFIG.examTitleBase} (${group})`;
    if (titleHeader) {
      titleHeader.textContent = currentExamTitle;
    }

    // Mark exam active
    examActive = true;

    // Set or reuse deadline
    if (!examDeadline) {
      examDeadline = Date.now() + EXAM_CONFIG.timeLimitMinutes * 60 * 1000;
      localStorage.setItem(DEADLINE_KEY, String(examDeadline));
      console.log("‚è± New examDeadline set:", new Date(examDeadline).toISOString());
    } else {
      console.log("‚è± Using existing examDeadline:", new Date(examDeadline).toISOString());
      if (Date.now() > examDeadline) {
        alert("Le d√©lai de 60 minutes est √©coul√©. Vous ne pouvez plus commencer l'√©preuve.");
        examActive = false;
        exam.style.display = "none";
        login.style.display = "block";
        return;
      }
    }

    isStartingExam = true;
    setTimeout(() => {
      isStartingExam = false;
      console.log("‚è± Startup grace period over");
    }, 1200);

    enableFullScreen();
    startTimer();
    randomizeQuestionOrder();
    randomizeSelectsKeepFirst();
  }

  // Start ‚Üí Confirm
  startBtn.addEventListener("click", () => {
    const firstName = (studentFirstNameInput.value || "").trim();
    const lastName = (studentLastNameInput.value || "").trim().toUpperCase();
    const email = (studentEmailInput.value || "").trim();
    const code = (classCodeInput.value || "").trim();
    const group = (groupSelect.value || "").trim();

    if (!firstName || !lastName || !email) {
      alert("Merci de remplir toutes les informations (nom, pr√©nom et e-mail).");
      return;
    }

    if (!group) {
      alert("Merci de s√©lectionner votre groupe.");
      return;
    }

    const isDebug = code === EXAM_CONFIG.debugCode;
    const isRealClass = code === EXAM_CONFIG.classCode;

    if (!isDebug && !isRealClass) {
      alert("Code de classe invalide.");
      return;
    }

    const fullName = `${lastName} ${firstName}`;
    selectedGroup = group;

    confirmName.textContent = fullName;
    confirmEmail.textContent = email;
    confirmGroup.textContent = group;

    login.style.display = "none";
    confirmSec.style.display = "block";
  });

  confirmBackBtn.addEventListener("click", () => {
    confirmSec.style.display = "none";
    login.style.display = "block";
  });

  confirmBeginBtn.addEventListener("click", () => {
    beginExam();
  });

  // Navigation Part A <-> Part B
  toPartB.addEventListener("click", () => {
    partA.classList.remove("active");
    partB.classList.add("active");
    ensureQuill();
  });

  toPartA.addEventListener("click", () => {
    partB.classList.remove("active");
    partA.classList.add("active");
  });

  // Submit handler
  form.addEventListener("submit", e => {
    e.preventDefault();
    submitExam();
  });

  function submitExam() {
    if (examSubmitted) return;
    examSubmitted = true;

    clearInterval(timer);

    if (submitBtn) {
      submitBtn.disabled = true;
      submitBtn.textContent = "Envoi en cours‚Ä¶";
    }

    const fd = new FormData(form);
    const name = fd.get("studentName") || studentNameField.value;
    const email = fd.get("studentEmail") || studentEmailField.value;

    let minutesUsed = EXAM_CONFIG.timeLimitMinutes;
    if (examDeadline) {
      const remainingMs = examDeadline - Date.now();
      const remainingMin = Math.max(0, Math.floor(remainingMs / 60000));
      minutesUsed = EXAM_CONFIG.timeLimitMinutes - remainingMin;
    }

    const emailHtml = quill ? quill.root.innerHTML.trim() : "<em>(No response)</em>";
    const totalQs = document.querySelectorAll('#partA select[name^="q"]').length || 10;

    let scoreA = 0;
    let partARowsHTML = "";
    for (let i = 1; i <= totalQs; i++) {
      const sel = fd.get("q" + i) || "No answer";
      const corr = correctAnswers["q" + i] || "";
      const ok = sel === corr;
      if (ok) scoreA++;
      const mark = ok ? "‚úÖ Correct" : `‚ùå Incorrect ‚Üí Correct answer: ${corr}`;
      partARowsHTML += `
        <tr>
          <td style="padding:8px;border:1px solid #ccc;">${wordNames[i - 1] || ("Q" + i)}</td>
          <td style="padding:8px;border:1px solid #ccc;">${sel}</td>
          <td style="padding:8px;border:1px solid #ccc;color:${ok ? "green" : "#b00"};">${mark}</td>
        </tr>`;
    }

    const partBScore = "___ / 10";
    const finalNote = "___ / 20";

    const group = selectedGroup || groupNameField.value || EXAM_CONFIG.classLabel;

    const htmlReport = `
      <h2 style="color:#004080;margin:0 0 8px 0;">
        Results ‚Äì ${currentExamTitle} ‚Äì ${name}
      </h2>
      <table style="border-collapse:collapse;width:100%;max-width:640px;font-size:14px;margin:0 0 12px 0;">
        <tr><td style="padding:4px 0;"><b>Student Name:</b> ${name}</td></tr>
        <tr><td style="padding:4px 0;"><b>Student Email:</b> ${email}</td></tr>
        <tr><td style="padding:4px 0;"><b>Group:</b> ${group}</td></tr>
        <tr><td style="padding:4px 0;"><b>Time Taken:</b> ${minutesUsed} min</td></tr>
      </table>
      <hr style="border:none;border-top:1px solid #ddd;margin:14px 0;">

      <h3 style="color:#004080;margin:10px 0 8px 0;">Part A ‚Äì Vocabulary Matching</h3>
      <table style="border-collapse:collapse;width:100%;font-size:15px;margin-top:8px;">
        <thead>
          <tr style="background:#004080;color:#fff;text-align:left;">
            <th style="padding:8px;border:1px solid #ccc;">Word</th>
            <th style="padding:8px;border:1px solid #ccc;">Student Answer</th>
            <th style="padding:8px;border:1px solid #ccc;">Result</th>
          </tr>
        </thead>
        <tbody>
          ${partARowsHTML}
        </tbody>
      </table>
      <p style="margin:10px 0 0 0;"><b>Part A Score:</b> ${scoreA} / ${totalQs}</p>

      <hr style="border:none;border-top:1px solid #ddd;margin:16px 0;">

      <h3 style="color:#004080;margin:10px 0 8px 0;">Part B ‚Äì Written Exercise</h3>
      <div style="border:1px solid #ccc;border-radius:6px;padding:10px;background:#f9f9f9;">
        ${emailHtml}
      </div>

      <table style="border-collapse:collapse;width:100%;font-size:15px;margin-top:6px;">
        <thead>
          <tr style="background:#004080;color:#fff;text-align:left;">
            <th style="padding:8px;border:1px solid #ccc;">Criterion</th>
            <th style="padding:8px;border:1px solid #ccc;">Maximum</th>
            <th style="padding:8px;border:1px solid #ccc;">Awarded</th>
          </tr>
        </thead>
        <tbody>
          <tr><td style="padding:8px;border:1px solid #ccc;">Vocabulary Use</td><td style="padding:8px;border:1px solid #ccc;">/3</td><td style="padding:8px;border:1px solid #ccc;">___ / 3</td></tr>
          <tr><td style="padding:8px;border:1px solid #ccc;">Structure & Clarity</td><td style="padding:8px;border:1px solid #ccc;">/3</td><td style="padding:8px;border:1px solid #ccc;">___ / 3</td></tr>
          <tr><td style="padding:8px;border:1px solid #ccc;">Language Accuracy & Tone</td><td style="padding:8px;border:1px solid #ccc;">/2</td><td style="padding:8px;border:1px solid #ccc;">___ / 2</td></tr>
          <tr><td style="padding:8px;border:1px solid #ccc;">Professional Style</td><td style="padding:8px;border:1px solid #ccc;">/2</td><td style="padding:8px;border:1px solid #ccc;">___ / 2</td></tr>
        </tbody>
      </table>
      <p style="margin:12px 0 6px 0;"><b>Instructor Comments:</b></p>
      <div style="border:1px solid #ccc;border-radius:6px;padding:10px;background:#fdfdfd;min-height:48px;">
        [Type feedback here]
      </div>
      <p style="margin:10px 0 0 0;"><b>Part B Score:</b> ${partBScore}</p>

      <hr style="border:none;border-top:1px solid #ddd;margin:16px 0;">

      <h4 style="color:#004080;margin:10px 0 8px 0;">Score Summary</h4>

      <table style="border-collapse:collapse;width:100%;max-width:460px;font-size:15px;">
        <tr>
          <td style="padding:8px;border:1px solid #ccc;">Part A Score</td>
          <td style="padding:8px;border:1px solid #ccc;">${scoreA} / ${totalQs}</td>
        </tr>
        <tr>
          <td style="padding:8px;border:1px solid #ccc;">Part B Score</td>
          <td style="padding:8px;border:1px solid #ccc;">${partBScore}</td>
        </tr>
        <tr>
          <td style="padding:8px;border:1px solid #ccc;"><b>Final Note</b></td>
          <td style="padding:8px;border:1px solid #ccc;"><b>${finalNote}</b></td>
        </tr>
      </table>

      <div style="border-top:1px solid #ccc;margin-top:16px;padding-top:8px;font-size:12px;color:#555;">
        <em>This report was generated automatically for the English Exam ‚Äì Business Resources.</em>
      </div>
    `;

    const subject = EXAM_CONFIG.emailSubjectTemplate
      .replace("(NAME)", name)
      .replace("(GROUP)", group);

    if (window.emailjs) {
      emailjs
        .send(
          "service_opm4h6b",
          "template_r0u784p",
          {
            from_name: name,
            from_email: email,
            subject,
            message_html: htmlReport
          },
          "Bb0oPYBiZGQcyIz5r"
        )
        .then(() => {
          alert("‚úÖ √âpreuve envoy√©e avec succ√®s.");
          // Clean deadline and reset state
          localStorage.removeItem(DEADLINE_KEY);
          examDeadline = null;
          resetToLanding();
        })
        .catch(err => {
          alert(
            "‚ùå Erreur lors de l'envoi de l'√©preuve : " +
            (err && err.text ? err.text : err)
          );
          console.error("EmailJS Error:", err);
          examSubmitted = false;
          if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.textContent = "Envoyer l'√©preuve";
          }
        });
    } else {
      alert("EmailJS n'est pas charg√© ; envoi simul√©.");
      examSubmitted = false;
      if (submitBtn) {
        submitBtn.disabled = false;
        submitBtn.textContent = "Envoyer l'√©preuve";
      }
    }
  }
});
</script>
